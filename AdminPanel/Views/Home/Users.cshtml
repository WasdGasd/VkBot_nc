@{
    ViewData["Title"] = "Пользователи";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>👥 Пользователи бота</h2>
    <div>
        <button onclick="loadUsers()" class="btn btn-primary">🔄 Обновить</button>
        <button class="btn btn-success" onclick="exportUsers()">📝 Экспорт</button>
    </div>
</div>

<!-- Фильтры и поиск -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <input type="text" id="searchInput" class="form-control" placeholder="🔍 Поиск по имени или ID...">
            </div>
            <div class="col-md-3">
                <select id="statusFilter" class="form-select">
                    <option value="all">Все статусы</option>
                    <option value="active">🟢 Активные</option>
                    <option value="inactive">⚪ Неактивные</option>
                    <option value="banned">🔴 Заблокированные</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="sortBy" class="form-select">
                    <option value="newest">Сначала новые</option>
                    <option value="oldest">Сначала старые</option>
                    <option value="name">По имени</option>
                    <option value="activity">По активности</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Статистика пользователей -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h5>Всего</h5>
                <h3 id="totalUsersCount">0</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h5>Активных</h5>
                <h3 id="activeUsersCount">0</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <h5>Новых сегодня</h5>
                <h3 id="newTodayCount">0</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h5>Онлайн</h5>
                <h3 id="onlineUsersCount">0</h3>
            </div>
        </div>
    </div>
</div>

<!-- Таблица пользователей -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Список пользователей</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Пользователь</th>
                        <th>Статус</th>
                        <th>Последняя активность</th>
                        <th>Сообщений</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <!-- Данные будут загружаться через JavaScript -->
                    <tr>
                        <td colspan="6" class="text-center">Загрузка...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Пагинация -->
        <nav>
            <ul class="pagination justify-content-center" id="pagination">
                <li class="page-item disabled">
                    <a class="page-link" href="#">Назад</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">Вперед</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

@section Scripts {
    <script>
        // Заглушка данных пользователей
        const demoUsers = [
            { id: 1, name: "Иван Иванов", status: "active", lastActivity: "2024-01-15 14:30", messageCount: 156, avatar: "👤" },
            { id: 2, name: "Мария Петрова", status: "active", lastActivity: "2024-01-15 13:45", messageCount: 89, avatar: "👩" },
            { id: 3, name: "Алексей Сидоров", status: "inactive", lastActivity: "2024-01-14 10:20", messageCount: 45, avatar: "👨" },
            { id: 4, name: "Елена Козлова", status: "active", lastActivity: "2024-01-15 15:10", messageCount: 234, avatar: "👩" },
            { id: 5, name: "Дмитрий Новиков", status: "banned", lastActivity: "2024-01-10 09:15", messageCount: 12, avatar: "👤" }
        ];

        function loadUsers() {
            // Обновляем статистику
            document.getElementById('totalUsersCount').textContent = '150';
            document.getElementById('activeUsersCount').textContent = '23';
            document.getElementById('newTodayCount').textContent = '5';
            document.getElementById('onlineUsersCount').textContent = '12';

            // Заполняем таблицу демо-данными
            const tableBody = document.getElementById('usersTable');
            tableBody.innerHTML = '';

            demoUsers.forEach(user => {
                const row = document.createElement('tr');

                let statusBadge = '';
                if (user.status === 'active') {
                    statusBadge = '<span class="badge bg-success">🟢 Активен</span>';
                } else if (user.status === 'inactive') {
                    statusBadge = '<span class="badge bg-secondary">⚪ Неактивен</span>';
                } else {
                    statusBadge = '<span class="badge bg-danger">🔴 Заблокирован</span>';
                }

                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <span class="fs-4 me-2">${user.avatar}</span>
                            <div>
                                <strong>${user.name}</strong><br>
                                <small class="text-muted">ID: ${user.id}</small>
                            </div>
                        </div>
                    </td>
                    <td>${statusBadge}</td>
                    <td>${user.lastActivity}</td>
                    <td>${user.messageCount}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewUser(${user.id})">
                            👁️ Просмотр
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="sendMessage(${user.id})">
                            💬 Сообщение
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function viewUser(userId) {
            alert(`Просмотр пользователя ID: ${userId}`);
        }

        function sendMessage(userId) {
            const message = prompt('Введите сообщение для пользователя:');
            if (message) {
                alert(`Сообщение отправлено пользователю ID: ${userId}\nТекст: ${message}`);
            }
        }

        function exportUsers() {
            alert('Экспорт пользователей в CSV...');
        }

        // Загружаем пользователей при открытии страницы
        document.addEventListener('DOMContentLoaded', loadUsers);

        // Поиск пользователей
        document.getElementById('searchInput').addEventListener('input', function(e) {
            console.log('Поиск:', e.target.value);
            // Здесь будет логика фильтрации
        });
    </script>
}